/* eslint-disable no-undef */
window.onload = () => {
    const code = `
        reset();
        g.clear();
        const img = {
            width: 400,
            height: 300,
            bpp: 1,
            buffer: E.toArrayBuffer(
                atob(
                    '/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8AAAAH8AAAH//B/wP//wf4P//+A///4AAB////gAP///wAH////////////////////gAAAAPgAAAH/4D+A//+A/Af//wB///AAAA///wAAH//4AAH///////////////////8AAAAAcAAAAP/AHwB//wB4A//+AD//4AAAB//8AAAH//AAAH///////////////////wAAAABwAAAAf8AfAH//AHgD//wAP//gAAAD//gAAAP/4AAAP///////////////////AAAAAHAAAAA/wB8AP/8AeAP//AAf/+AAAAH/8AAAAf/AAAAf//////////////////+AAAAA8AAAAD/AHwA//gB4A//8AB//4AAAAP/gAAAA/4AAAA///////////////////8AAAAHwB/wAH8AfAD/+AHgD//gAD//gD+AAf8AAAAB/gAcAD/////////////////////AH//AH/wAfwB+AH/4A+AP/+AAP/+AP/AB/wADgAH8AP8AH////////////////////8Af/8Af/gB/AH4Af/AD4A//wAA//4A/+AD+AB/wAPwA/4Af////////////////////wB//wB//AH8AfwB/8AfgD//AAB//gD/8AP4Af/gAfAH/wB/////////////////////AH//AH/8AfwB/AD/wB+AP/8AAH/+AP/wA/AB//AB8Af/AP////////////////////8Af/8Af/wB/AH8AP+AH4A//gAAP/4A//gB8AP/+AHwA/+A/////////////////////wB//wB//AH8Af4A/4A/gD/+AIA//gD/+AHgB//8APAA/8H/////////////////////AH//AH/4AfwB/gB/gD+AP/wBgB/+AP/4AeAH//wA8AAf//////////////////////8Af/8Af/AB/AH+AH8AP4A//AHAH/4A//wB4Af//AD4AAH//////////////////////wB//wB/gAP8Af8AfwB/gD/4AcAf/gD//AHgB//8APgAAD//////////////////////AH//AAAAA/wB/wA+AH+AP/gDwA/+AP/8AeAP//4A/AAAB/////////////////////8Af/8AAAAH/AH/gD4A/4A/+APgD/4A//wB4A///gD+AAAD/////////////////////wB//wAAAA/8Af+APgD/gD/wA+AH/gD//AHgD//+AP+AAAH/////////////////////AH//AAAAH/wB/4AcAP+AP/AH4Af+AP/8AeAP//4A/+AAAP////////////////////8Af/8AAAB//AH/wBwB/4A/4AfwB/4A//wB4A///gD//AAAf////////////////////wB//wAAAP/8Af/AHAH/gD/gB/AD/gD/+AHgB//8AP//gAA/////////////////////AH//AHAAf/wB/8AIAf+AP+AAAAP+AP/4AeAH//wA///4AD////////////////////8Af/8AfgA//AH/4AgD/4A/wAAAAf4A//gB4Af//ADwH/4AP////////////////////wB//wB/AB/8Af/gAAP/gD/AAAAB/gD/+AHwB//8APAP/wA/////////////////////AH//AH+AD/wB/+AAB/+AP4AAAAD+AP/wA/AD//gB4A//gD////////////////////8Af/8Af4AH/AH/8AAH/4A/gAAAAP4A//AD8AH/8AHgB/+AP////////////////////wB//wB/wAf8Af/wAAf/gD+AAAAA/gD/4AP4AP/gA+AH/4A/////////////////////AH//AH/gA/wB//gAD/+APwA//gB+AP/AB/gAf8AD4AP/AD////////////////////8Af/8Af+AD/AH/+AAP/4A/AD/+AH4A/wAH/AAOAAfwAf4AP////////////////////wB//wB/8AH8Af/4AA//gD4Af/4APgAAAA/8AAAAB/AAeAB/////////////////////AH//AH/wAfwB//wAH/+APgB//wA+AAAAD/4AAAAP+AAAAH////////////////////8Af/8Af/gA/AH//AAf/4A+AH//AD4AAAAf/wAAAB/8AAAA/////////////////////wB//wB//AD8Af/+AD//gD4A//+APgAAAD//gAAAP/4AAAH/////////////////////AH//AH/8APwB//4AP/+APgD//4A+AAAAf//gAAB//wAAA/////////////////////+A//+A//4B/gP//wB//8B/Af//wH8AAAH///AAAf//wAAP/////////////////////8H//8H//wP/B///gP//4P+D///g/4AAB////gAP///wAH/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+AD////////4AGAAcfh8B//////////////////////////////////////////////4AH////////gAIABg+HgD//////////////////////////////////////////////h4P///////+Hg/D+B4cMH/////////////////////////////////////////////+Hw////////4fD8P4Hhh4f/////////////////////////////////////////////4fD////////h8Pw/gOGHh//////////////////////////////////////////////h8IA8D4AQP+Hw/D+A4c+H8IP4HwB/wH8B4AQPwPgB+A/APAH//////////////////+HwgDgDgAAf4eD8P4Bh/wfwAPAHAH+APgDgAAeAOADwB4AcAf//////////////////4eGDcMGDBB/gAfw/hCH/D/Aw4YMG/wwcOGDBBwwYMGGDjwwb///////////////////gAYfh4YcOH+AA/D+EIf4f8HhDww/+Hhh8IcOGHhh4Q8P8DD///////////////////+AHh+ABhw4f4fD8P4YB+D/w+EADD/4f+Hwhw4YAGHhD/8AMP///////////////////4f+H4AGHDh/h+Hw/hgHwf/D4QAMP/h/4fCHDhgAYeEP/gAw////////////////////h/4fh/4cOH+H4fD+HAeD/8PhD/w/+H7h8IcOGH/h4Q+cPDD///////////////////+H/h+Hxhw4f4fh8P4eBwf/wcEPjD/4eGHwhw4YfGHhDww8MP///////////////////4f+H8OGHDh/h8Hw/h4HD//Aw4cMP/wwcOGHDhw4YeGGDBgw////////////////////h/4f4A4cOH+AA/D+HwYAH8ADwBw//gD4A4cOHgDh4YAeABD///////////////////+H/h/wHhw4f4AH8P4fhwAfwA/gPD//AfwHhw4fAeHh4H8GMP/////////////////////////////////////////D///////////////////w/////////////////////////////////////////////8P///////////////////h/////////////////////////////////////////////w////////////////////H/////////////////////////////////////////////D///////////////////g/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////'
                )
            ),
        };
        g.drawImage(img);
        g.flip();
    `;

    // g.setFontVector(15);
    // let titol = 'TRIVIADOS',
    //     subtitol = 'Press BTN2 to start';
    // g.drawString(titol, (g.getWidth() / 2) + (g.stringWidth(subtitol) / 2), 20);
    // g.setFontVector('5');
    // g.drawString(subtitol, (g.getWidth() / 2) + (g.stringWidth(subtitol) / 2), 40);

    const tipusPreguntesFix = document.getElementById('preguntes-fixed');
    const tipusPreguntesInfinite = document.getElementById('preguntes-infinite');
    const startButton = document.getElementById('bt-start');
    let connection;

    tipusPreguntesFix.addEventListener('click', () => {
        document.getElementById('num-preguntes').removeAttribute('disabled');
    });

    tipusPreguntesInfinite.addEventListener('click', () => {
        document.getElementById('num-preguntes').setAttribute('disabled', true);
    });

    startButton.onclick = () => {
        if (connection) {
            connection.close();
            connection = undefined;
        }

        Puck.connect(c => {
            if (!c) {
                alert(`No s'ha pogut establir la connexió!`);
                return;
            }

            connection = c;
            // let buf = '';
            // connection.on('data', d => {
            // 	buf += d;
            // 	let i = buf.indexOf('\n');
            // 	while (i >= 0) {
            // 		onLine(buf.substr(0, i));
            // 		buf = buf.substr(i + 1);
            // 		i = buf.indexOf('\n');
            // 	}
            // });

            connection.write(code,
                () => {
                    console.log('Reset...');
                    console.log(`Code: %o`, code);
                }
            );
        });
    };
};
